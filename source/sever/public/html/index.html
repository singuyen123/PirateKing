<html lang="en">

<head>
  <meta charset="utf-8">
  <title>BattleShip</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="/public/css/index.css">
  <script src="/socket.io/socket.io.js"></script>
  <!-- <script src="/socket.io-master/test/socket.io.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script> --> -->
  <script src="/public/js/index.js"></script>

</head>

<body>
  <div id="main">
    <div class="board">
      <div class="displays">
        <div class="top">
          <ul class="grid">
            <canvas id="canvasTop" width="300" height="300"
              style="background: rgb(16, 197, 197);">
            </canvas>
          </ul>
        </div>
        <div class="bottom">
          <ul class="grid">
            <canvas id="canvasBottom" width="300" height="300"
              style="background: rgb(16, 197, 197);">
            </canvas>
          </ul>
        </div>
      </div>
    </div>
    <div class="panel">
      <div class="topPanel">
        <div class="layout">
          <div class='buttons one'>One-Player</div>
          <div class='buttons multi'>Two-Player</div>
          <div class='buttons options'>Options</div>
        </div>
      </div>
      <div class='console'>
        <span class='text'></span>
      </div>
    </div>
  </div>

  <script>
    var c = document.getElementById("canvasBottom");
    var ctx = c.getContext("2d");
    ctx.fillStyle = "#FF0000";
    ctx.border ="1px";
    ctx.border.solid ="#000000";
    var i=0,j=0;
    for(i=0;i<300;i=i+29)
    {
      for(j=0;j<300;j=j+29)
      {
        ctx.fillRect(i,j,28.5,28.5);
      }
    }
</script>


<script>
  var c = document.getElementById("canvasTop");
  var ctx = c.getContext("2d");
  ctx.fillStyle = "#FF0000";
  ctx.border ="1px";
  ctx.border.solid ="#000000";
  var i=0,j=0;
  for(i=0;i<300;i=i+29)
  {
    for(j=0;j<300;j=j+29)
    {
      ctx.fillRect(i,j,28.5,28.5);
    }
  }
</script>

<script>
  var socket = io("http://192.168.137.1:3002");
  socket.emit('connection',"hehe");

        //client nhận dữ liệu từ server
  socket.on('Server', function(data)
  {
    console.log( );
  });

    var i=0,j=0;
    //di chuyen con tro dat thuyen
    function moveShip(i,j) {
    var c = document.getElementById("canvasTop");
    var ctx = c.getContext("2d");
    ctx.fillStyle = "#01DF01";
    ctx.border ="1px";
    ctx.border.solid ="#000000";
    ctx.fillRect(i,j,28.5,28.5);
    }

    //xoa bo o trong sau khi con tro di chuyen qua
    function removeShip(i,j) {
    var c = document.getElementById("canvasTop");
    var ctx = c.getContext("2d");
    ctx.fillStyle = "#FF0000";
    ctx.border ="1px";
    ctx.border.solid ="#000000";
    ctx.fillRect(i,j,28.5,28.5);
    }
    //khai bao mang luu tru gia tri cua thuyen dc dat
    var location_i =[];
    var location_j =[];
    //Dat thuyen o vi tri i,j va kich thuoc 4 o theo chuyen ngang
    function setShip(i,j){
      moveShip(i+29,j);
      location_i[0]=i+29;
      moveShip(i+29+29,j);
      location_i[1]=i+29+29;
      moveShip(i+29+29+29,j);
      location_i[2]=i+29+29+29;
      location_j[0]=j;
      console.log(location_i);
    }

    //danh thuyen nen vi tri di chuyen danh trung vs vi tri luu tru thuyen
    function hitShip(i,j){
      var c = document.getElementById("canvasTop");
      var ctx = c.getContext("2d");
      ctx.fillStyle = "#FFFF00";
      ctx.border ="1px";
      ctx.border.solid ="#000000";
      ctx.fillRect(i,j,28.5,28.5);
    }

    //check vi tri con tro co trung voi vi tri luu tru gt cua thuyen
    function checkShip(i,j)
    {
      for (var l = 0; l < location_i.length; l++){
        for (var k = 0; k < location_j.length; k++){
          if(location_i[l] == i && location_j[k] == j){
            hitShip(i,j);
            console.log("location_hit"+"("+i+","+j+")");
          }
          else continue;
        }
      }
    }

//Con tro danh thuyen
var e=0,f=0;
    socket.on('Hit_ship', function (msg) {
      switch(msg){
      case 'Left': 
        if(e==0 )
        {
          moveShip(e,f);
          e=f-29;
        }
        else
        {
          removeShip(e,f)
          e=e-29;
          moveShip(e,f);
        }
      break;
      case 'Right':
        if(e==300 )
        {
          moveShip(e,f);
        }
        else
        {
          removeShip(e,f)
          e=f+29;
          moveShip(e,f);
          //console.log("value"+i+j);
        }
          
      break;
      case 'down':
        if(f==0 )
        {
          moveShip(e,f);
        }
        else
        {
          removeShip(e,f)
          f=f-29;
          moveShip(e,f);
        }
          
      break;
      case 'up':
        if(f==300)
        {
          moveShip(e,f);
        } 
        else
        {
          removeShip(e,f)
          f=f+29;
          moveShip(e,f);
        }
         
      break;
      case 'hit':
        console.log("hit ship" + "(" + e + "," + f +" )")
        checkShip(e,f);
      break;
      }
    }); 

//con tro dat thuyen
    socket.on('move_ship', function (msg) {
      switch(msg){
      case 'Left': 
        if(i==0 )
        {
          moveShip(i,j);
          i=i-29;
        }
        else
        {
          removeShip(i,j)
          i=i-29;
          moveShip(i,j);
        }
      break;
      case 'Right':
        if(i==300 )
        {
          moveShip(i,j);
         
        }
        else
        {
          removeShip(i,j)
          i=i+29;
          moveShip(i,j);

          //console.log("value"+i+j);
        }
          
      break;
      case 'down':
        if(j==0 )
        {
          moveShip(i,j);
        }
        else
        {
          removeShip(i,j)
          j=j-29;
          moveShip(i,j);
        }
          
      break;
      case 'up':
        if(j==300)
        {
          moveShip(i,j);
        } 
        else
        {
          removeShip(i,j)
          j=j+29;
          moveShip(i,j);
        }
         
      break;
      case 'Dat_thuyen':
        setShip(i,j);
        console.log("Location set ship" + "("+ i+","+j+")");
       // console.log(location_i[1]);
        console.log("array i"+"["+location_i+"]");
        console.log("array j"+"["+location_j+"]");
        i=0;
        j=0;
      break;
      }
    }); 

</script>


</body>


</html>