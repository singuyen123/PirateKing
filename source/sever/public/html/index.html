<html lang="en">

<head>
  <meta charset="utf-8">
  <title>BattleShip</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="/public/css/index.css">
  <script src="/socket.io/socket.io.js"></script>
  <!-- <script src="/socket.io-master/test/socket.io.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script> -->-->
  <script src="/public/js/index.js"></script>

</head>

<body>
  <div id="main">
    <div class="board">
      <div class="displays">
        <div class="top">
          <ul class="grid">
            <canvas id="canvasTop" width="300" height="300" style="background: rgb(16, 197, 197);">
            </canvas>
          </ul>
        </div>
        <div class="bottom">
          <ul class="grid">
            <canvas id="canvasBottom" width="300" height="300" style="background: rgb(16, 197, 197);">
            </canvas>
          </ul>
        </div>
      </div>
    </div>
    <div class="panel">
      <div class="topPanel">
        <div class="layout">
          <div class='buttons one'>One-Player</div>
          <div class='buttons multi'>Two-Player</div>
          <div class='buttons options'>Options</div>
        </div>
      </div>
      <div class='console'>
        <span class='text'></span>
      </div>
    </div>
  </div>

  <script>
    var c = document.getElementById("canvasBottom");
    var ctx = c.getContext("2d");
    ctx.fillStyle = "#FF0000";
    ctx.border = "1px";
    ctx.border.solid = "#000000";
    var i = 0, j = 0;
    for (i = 0; i < 300; i = i + 29) {
      for (j = 0; j < 300; j = j + 29) {
        ctx.fillRect(i, j, 28.5, 28.5);
      }
    }
  </script>


  <script>
    var c = document.getElementById("canvasTop");
    var ctx = c.getContext("2d");
    ctx.fillStyle = "#FF0000";
    ctx.border = "1px";
    ctx.border.solid = "#000000";
    var i = 0, j = 0;
    for (i = 0; i < 300; i = i + 29) {
      for (j = 0; j < 300; j = j + 29) {
        ctx.fillRect(i, j, 28.5, 28.5);
      }
    }
  </script>

  <script>
    var socket = io();

    var i = 0, j = 0;
    //di chuyen con tro dat thuyen
    function moveShip(i, j) {
      var c = document.getElementById("canvasTop");
      var ctx = c.getContext("2d");
      ctx.fillStyle = "#01DF01";
      ctx.border = "1px";
      ctx.border.solid = "#000000";
      ctx.fillRect(i, j, 28.5, 28.5);
    }

    //xoa bo o trong sau khi con tro di chuyen qua
    function removeShip(i, j) {
      var c = document.getElementById("canvasTop");
      var ctx = c.getContext("2d");
      ctx.fillStyle = "#FF0000";
      ctx.border = "1px";
      ctx.border.solid = "#000000";
      ctx.fillRect(i, j, 28.5, 28.5);
    }

    /*--------------------------dat thuyen ngang--------------------*/
    //khai bao mang luu tru gia tri cua thuyen dc dat
    var location_i = [];
    var location_j = [];
    //Dat thuyen o vi tri i,j va kich thuoc 5 o theo chuyen ngang
    function setShip(i, j, id) {
      moveShip(i + 29, j);
      location_j[0] = i + 29;
      moveShip(i + 29 + 29, j);
      location_j[1] = i + 29 + 29;
      moveShip(i + 29 + 29 + 29, j);
      location_j[2] = i + 29 + 29 + 29;
      moveShip(i + 29 + 29 + 29 + 29, j);
      location_j[3] = i + 29 + 29 + 29 + 29;
      location_i[0] = j;
      console.log(location_i);
    }

    //khai bao mang luu tru gia tri cua thuyen 1 dc dat
    var location_i1 = [];
    var location_j1 = [];
    //Dat thuyen 1 vi tri i,j va kich thuoc 4 o theo chuyen ngang
    function setShip1Hor(i, j, id) {
      moveShip(i + 29, j);
      location_j1[0] = i + 29;
      moveShip(i+ 29 + 29, j);
      location_j1[1] = i + 29 + 29;
      moveShip(i + 29 + 29 + 29, j);
      location_j1[2] = i + 29 + 29 + 29;
      location_i1[0] = j;
      console.log(location_i1);
    }

    //khai bao mang luu tru gia tri cua thuyen 2 dc dat
    var location_i2 = [];
    var location_j2 = [];
    //Dat thuyen 2 vi tri i,j va kich thuoc 3 o theo chuyen ngang
    function setShip2Hor(i, j, id) {
      moveShip(i + 29, j);
      location_j2[0] = i + 29;
      moveShip(i+ 29 + 29, j);
      location_j2[1] = i + 29 + 29;
      location_i2[0] = j;
      console.log(location_i2);
    }

    //khai bao mang luu tru gia tri cua thuyen 3 dc dat
    var location_i3 = [];
    var location_j3 = [];
    //Dat thuyen 3 vi tri i,j va kich thuoc 2 o theo chuyen ngang
    function setShip3Hor(i, j, id) {
      moveShip(i + 29, j);
      location_j3[0] = i + 29;
      location_i3[0] = j;
      console.log(location_i3);
    }

    /*-------------------------------dat chuyen doc-----------------------*/
    //khai bao mang luu tru gia tri cua thuyen 0 dc dat
    var location_i0v = [];
    var location_j0v = [];
    //Dat thuyen o vi tri i,j va kich thuoc 5 o theo chuyen ngang
    function setShip0Ver(i, j, id) {
      moveShip(i, j+29);
      location_i0v[0] = j + 29;
      moveShip(i , j+ 29 + 29);
      location_i0v[1] = j + 29 + 29;
      moveShip(i , j+ 29 + 29 + 29);
      location_i0v[2] = j + 29 + 29 + 29;
      moveShip(i, j+ 29 + 29 + 29 + 29);
      location_i0v[3] = j + 29 + 29 + 29 + 29;
      location_j0v[0] = i;
      console.log(location_j0v);
    }

    //khai bao mang luu tru gia tri cua thuyen 1 dc dat
    var location_i1v = [];
    var location_j1v = [];
    //Dat thuyen 1 vi tri i,j va kich thuoc 4 o theo chuyen doc
    function setShip1Ver(i, j, id) {
      moveShip(i , j+29);
      location_i1v[0] = j + 29;
      moveShip(i, j+ 29 + 29);
      location_i1v[1] = j + 29 + 29;
      moveShip(i, j+ 29 + 29 + 29);
      location_i1v[2] = j + 29 + 29 + 29;
      location_j1v[0] = i;
      console.log(location_i1v);
    }

    //khai bao mang luu tru gia tri cua thuyen 2 dc dat
    var location_i2v = [];
    var location_j2v = [];
    //Dat thuyen 2 vi tri i,j va kich thuoc 3 o theo chuyen doc
    function setShip2Ver(i, j, id) {
      moveShip(i , j+29);
      location_i2v[0] = j + 29;
      moveShip(i, j+ 29 + 29);
      location_i2v[1] = j + 29 + 29;
      location_j2v[0] = i;
      console.log(location_i2v);
    }

    //khai bao mang luu tru gia tri cua thuyen 3 dc dat
    var location_i3v = [];
    var location_j3v = [];
    //Dat thuyen 3 vi tri i,j va kich thuoc 2 o theo chuyen ngang
    function setShip3Ver(i, j, id) {
      moveShip(i, j+29);
      location_i3v[0] = j + 29;
      location_j3v[0] = i;
      console.log(location_i3v);
    }
  /*--------------------ket thuc dat thuyen---------------------------*/
    //danh thuyen nen vi tri di chuyen danh trung vs vi tri luu tru thuyen
    function hitShip(i, j) {
      var c = document.getElementById("canvasTop");
      var ctx = c.getContext("2d");
      ctx.fillStyle = "#FFFF00";
      ctx.border = "1px";
      ctx.border.solid = "#000000";
      ctx.fillRect(i, j, 28.5, 28.5);
    }

    //check vi tri con tro co trung voi vi tri luu tru gt cua thuyen
    function checkShip(i, j) {
      for (var l = 0; l < location_i.length; l++) {
        for (var k = 0; k < location_j.length; k++) {
          if (location_i[l] == i && location_j[k] == j) {
            hitShip(i, j);
            console.log("location_hit" + "(" + i + "," + j + ")");
          }
          else continue;
        }
      }
    }

    //Con tro danh thuyen
    var e = 0, f = 0;
    socket.on('Hit_ship', function (msg) {
      switch (msg) {
        case 'Left':
          if (e == 0) {
            moveShip(e, f);
            e = f - 29;
          }
          else {
            removeShip(e, f)
            e = e - 29;
            moveShip(e, f);
          }
          break;
        case 'Right':
          if (e == 300) {
            moveShip(e, f);
          }
          else {
            removeShip(e, f)
            e = f + 29;
            moveShip(e, f);
            //console.log("value"+i+j);
          }

          break;
        case 'down':
          if (f == 0) {
            moveShip(e, f);
          }
          else {
            removeShip(e, f)
            f = f - 29;
            moveShip(e, f);
          }

          break;
        case 'up':
          if (f == 300) {
            moveShip(e, f);
          }
          else {
            removeShip(e, f)
            f = f + 29;
            moveShip(e, f);
          }

          break;
        case 'hit':
          console.log("hit ship" + "(" + e + "," + f + " )")
          checkShip(e, f);
          break;
      }
    });

    //con tro dat thuyen
    socket.on('move_ship', function (msg) {
      if(msg.id=1){
      switch (msg.action) {
        case 'Left':
          if (j == 0) {
            moveShip(i, j);
          }
          else {
            removeShip(i, j)
            i = i - 29;
            moveShip(i, j);
          }
          break;
        case 'Right':
          if (i == 300) {
            moveShip(i, j);

          }
          else {
            removeShip(i, j)
            i = i + 29;
            moveShip(i, j);

            //console.log("value"+i+j);
          }

          break;
        case 'Down':
          if (j == 0) {
            moveShip(i, j);
          }
          else {
            removeShip(i, j)
            j = j - 29;
            moveShip(i, j);
          }

          break;
        case 'Up':
          if (j == 300) {
            moveShip(i, j);
          }
          else {
            removeShip(i, j)
            j = j + 29;
            moveShip(i, j);
          }

          break;
        case 'Drop_horizontal':
          setShip(i, j);
          console.log("Location set ship" + "(" + i + "," + j + ")");
          // console.log(location_i[1]);
          console.log("array i" + "[" + location_i + "]");
          console.log("array j" + "[" + location_j + "]");
          i = 0;
          j = 0;
          break;
        case 'Drop_vertical':
        setShip(i, j);
          console.log("Location set ship" + "(" + i + "," + j + ")");
          // console.log(location_i[1]);
          console.log("array i" + "[" + location_i + "]");
          console.log("array j" + "[" + location_j + "]");
          i = 0;
          j = 0;
          break;

      }
    }else{

    }
    });

  </script>


</body>


</html>